<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <title>Keyboard</title>
  <style type="text/css">
    :root {
      font-size: 20px;
    }

    #keyboard {
      border-radius: 10px;
      background-color: #d5d7dd;
      padding: 5px 2px;
    }

    .row {
      margin: 0.8rem 0.1rem;
      text-align: center;
    }

    .key {
      background-color: #fefefe;
      -webkit-box-shadow: #333 1px 1px 2px 0px;
      height: 3rem;
      line-height: 2.8rem;
      font-size: 1.5rem;
      border-radius: 10px;
      width: 2.5rem;
      text-align: center;
      display: inline-block;
      margin: 0rem 0.1rem;
      font-family: Helvetica;
      font-weight: 400;
      color: #000000;
    }

    .systemkey {
      background-color: #b4b8c0;
      color: #000000;
      font-weight: 600;
    }

    .keyPress {
      background-color: #b4b8c0;
    }

    .systemkeyPress {
      color: #000000;
      background-color: #fefefe;
    }
  </style>
</head>

<body>
  <div class="container">
    <div id="keyboard" class="is-korean">
      <div class="row">
        <div id="KeyQ" class="key">ㅂ</div>
        <div id="KeyW" class="key">ㅈ</div>
        <div id="KeyE" class="key">ㄷ</div>
        <div id="KeyR" class="key">ㄱ</div>
        <div id="KeyT" class="key">ㅅ</div>
        <div id="KeyY" class="key">ㅛ</div>
        <div id="KeyU" class="key">ㅕ</div>
        <div id="KeyI" class="key">ㅑ</div>
        <div id="KeyO" class="key">ㅐ</div>
        <div id="KeyP" class="key">ㅔ</div>
      </div>
      <div class="row">
        <div id="KeyA" class="key">ㅁ</div>
        <div id="KeyS" class="key">ㄴ</div>
        <div id="KeyD" class="key">ㅇ</div>
        <div id="KeyF" class="key">ㄹ</div>
        <div id="KeyG" class="key">ㅎ</div>
        <div id="KeyH" class="key">ㅗ</div>
        <div id="KeyJ" class="key">ㅓ</div>
        <div id="KeyK" class="key">ㅏ</div>
        <div id="KeyL" class="key">ㅣ</div>
      </div>
      <div class="row">
        <div class="key systemkey" style="width: 3.5rem">⌂</div>
        <div id="KeyZ" class="key">ㅋ</div>
        <div id="KeyX" class="key">ㅌ</div>
        <div id="KeyC" class="key">ㅊ</div>
        <div id="KeyV" class="key">ㅍ</div>
        <div id="KeyB" class="key">ㅠ</div>
        <div id="KeyN" class="key">ㅜ</div>
        <div id="KeyM" class="key">ㅡ</div>
        <div class="key systemkey" style="width: 3.5rem">⌫</div>
      </div>
      <div class="row">
        <div class="key systemkey" style="width: 3.5rem">123</div>
        <div class="key systemkey" style="width: 3rem">☺️</div>
        <div id="Space" class="key" style="width: 15rem; font-weight: 400;">간격</div>
        <div class="key systemkey" style="width: 6.5rem">⏎</div>
      </div>
    </div>
  </div>
  <p style="display:none;" source="following-url">https://gist.github.com/itszero/972142</p>


  <div>
    <input type="text" />
  </div>
<p>

  TODO: 
  // CSS 만지기 
  / 특수문자 키보드 배열 이슈
    - 특수문자 배열일 때는 row3에서 키 갯수가 다름...
    - row별로 클래스명 따로 지정하기 + 특수문자 배열일 때는 'ㅋ' 키를 row2로 옮기고, 'ㅡ' 키를 display:none 으로 바꾸기
    - iPhone 키보드 기본 font-family 찾기
  / 키보드 누름 이벤트 마저 하기 
    - 시스템키 + 특수문자키들은 하나하나 연결해 줘야 할 듯... keyDown 함수
  / 한영 변환 이슈
    - 한글을 입력할 때는 입력 중인 글자 아래에 밑줄 커서가 깜빡인다. 
    - 이 상태에서는 어떤 키들을 누르면 두 번 입력된다. ex) 화살표, 오른쪽 쉬프트, 백슬래쉬 등...
    - 현재 그 글자를 편집 중인지, 글자 편집이 끝나고 다음 글자로 넘어가는 건지 확인해야 해서 시스템적으로 그렇게 돼 있다고 한다.
    - event.nativeEvent.isComposing <== 이 속성을 이용하면 판단할 수 있다고 한다.
    - 나는 그냥 화살표 같은 거 눌러서 밑줄 커서를 없앤 뒤에 입력해도 되는 기능들이라서 그냥 쓰기로 함...
</p>

  <script>

    document.addEventListener('keydown', function (e) {
      console.log(e.code);
      keyDown(e.code);
      changeKeyboard(e.code);

    });

    document.addEventListener('keyup', function (e) {

      keyUp(e.code)
    });


    function keyDown(code) {
      const targetKey = document.querySelector('div#' + code);
      if (targetKey) {
        targetKey.classList.add('keyPress');
      }
    }

    function keyUp(code) {
      const targetKey = document.querySelector('div#' + code);
      if (targetKey && targetKey.classList.contains('keyPress')) {
        targetKey.classList.remove('keyPress');
      }
    }


    function changeKeyboard(code) {
      // 한영 변환 키의 e.code 값
      const toggleKorean = "ShiftRight";
      // 특수문자 변환 키의 e.code 값
      const toggleSymbols = "Backslash";
      if(code != toggleKorean && code != toggleSymbols) {
        // 한영 변환이나 특수문자 변환이 아니면 그대로 끝내기
        return;
      }
      const keyList = [ 
                {code: 'KeyQ', Korean: 'ㅂ', English: 'q', Symbols: '1'},
                {code: 'KeyW', Korean: 'ㅈ', English: 'w', Symbols: '2'},
                {code: 'KeyE', Korean: 'ㄷ', English: 'e', Symbols: '3'},
                {code: 'KeyR', Korean: 'ㄱ', English: 'r', Symbols: '4'},
                {code: 'KeyT', Korean: 'ㅅ', English: 't', Symbols: '5'},
                {code: 'KeyY', Korean: 'ㅛ', English: 'y', Symbols: '6'},
                {code: 'KeyU', Korean: 'ㅕ', English: 'u', Symbols: '7'},
                {code: 'KeyI', Korean: 'ㅑ', English: 'i', Symbols: '8'},
                {code: 'KeyO', Korean: 'ㅐ', English: 'o', Symbols: '9'},
                {code: 'KeyP', Korean: 'ㅔ', English: 'p', Symbols: '0'},
                {code: 'KeyA', Korean: 'ㅁ', English: 'a', Symbols: '-'},
                {code: 'KeyS', Korean: 'ㄴ', English: 's', Symbols: '/'},
                {code: 'KeyD', Korean: 'ㅇ', English: 'd', Symbols: ':'},
                {code: 'KeyF', Korean: 'ㄹ', English: 'f', Symbols: ';'},
                {code: 'KeyG', Korean: 'ㅎ', English: 'g', Symbols: '('},
                {code: 'KeyH', Korean: 'ㅗ', English: 'h', Symbols: ')'},
                {code: 'KeyJ', Korean: 'ㅓ', English: 'j', Symbols: '\\'},
                {code: 'KeyK', Korean: 'ㅏ', English: 'k', Symbols: '&'},
                {code: 'KeyL', Korean: 'ㅣ', English: 'l', Symbols: '@'},
                {code: 'KeyZ', Korean: 'ㅋ', English: 'z', Symbols: '\"'},
                {code: 'KeyX', Korean: 'ㅌ', English: 'x', Symbols: '.'},
                {code: 'KeyC', Korean: 'ㅊ', English: 'c', Symbols: ','},
                {code: 'KeyV', Korean: 'ㅍ', English: 'v', Symbols: '?'},
                {code: 'KeyB', Korean: 'ㅠ', English: 'b', Symbols: '!'},
                {code: 'KeyN', Korean: 'ㅜ', English: 'n', Symbols: '\''},
                {code: 'KeyM', Korean: 'ㅡ', English: 'm', Symbols: ''}
              ];
              
        // 키보드 요소
        const kb = document.querySelector('div#keyboard');
        // 키보드를 무엇으로 바꿀지
        let changeTo ='';

        // 한영 변환
        if(code == toggleKorean) {
          kb.classList.remove('is-symbols');
          if(kb.classList.contains('is-korean')) {
            changeTo='English';
            kb.classList.remove('is-korean');
          } else {
            kb.classList.add('is-korean');
            changeTo='Korean';
          }
        }

        // 특수문자 변환
        if(code == toggleSymbols) {
          if(kb.classList.contains('is-symbols')) {
            changeTo='Korean';
            kb.classList.remove('is-symbols');
            kb.classList.add('is-korean');
          } else {
            kb.classList.add('is-symbols');
            kb.classList.remove('is-korean');
            changeTo='Symbols';
          }
        }
        
        keyList.forEach(function(ele, index) {
          document.querySelector('#'+ele.code).innerText = ele[changeTo];
        });
    }
  </script>
</body>

</html>